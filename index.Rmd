---
title: "Calendario Settimana"
output: html_document
---

<style>
  h1.title {
    display: none;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>


 <font size="1">Ultimo aggiornamento: `r format(now("CET"), "%d %B %Y %H:%M")`</font>

```{=html}

<div style="display: flex; gap: 20px; font-family: Arial, sans-serif; font-size: 14px; font-weight: bold;">
  <p id="clock-bologna"></p>
  <p id="clock-cleveland"></p>
  <p id="clock-goodyear"></p>
</div>

<script>
  // Get authorized IDs from R (Injected by GitHub Actions)
  const authorizedIds = [`r paste0('"', gsub(",", '","', Sys.getenv("WVR_AUTHORIZED_DEVICES")), '"')`];

    // Load FingerprintJS
  FingerprintJS.load().then(fp => {
    fp.get().then(result => {
      const fingerprint = result.visitorId;

      if (!authorizedIds.includes(fingerprint)) {
        window.location.href = "unauthorized.html";
      }
    });
  });

  // Refresh page every hour (3600000 ms)
  setTimeout(function () {
    location.reload();
  }, 3600000);
  
  function getOffsetForTimeZone(timezone) {
    const now = new Date();
    const timeZoneDate = new Date(now.toLocaleString("en-US", { timeZone: timezone }));
    return timeZoneDate.getHours() - now.getUTCHours();
  }

  function updateClocks() {
    let now = new Date();

    let timeZones = {
      "clock-bologna": { name: "Bologna", offset: getOffsetForTimeZone("Europe/Rome") },
      "clock-cleveland": { name: "Cleveland", offset: getOffsetForTimeZone("America/New_York") },
      "clock-goodyear": { name: "Goodyear", offset: -7 } // Arizona stays at UTC-7
    };

    for (let id in timeZones) {
      let localTime = new Date(now.getTime() + timeZones[id].offset * 3600 * 1000);
      let hours = localTime.getUTCHours().toString().padStart(2, "0");
      let minutes = localTime.getUTCMinutes().toString().padStart(2, "0");
      
      document.getElementById(id).textContent = `${timeZones[id].name}: ${hours}:${minutes}`;
    }
  }
  
  setInterval(updateClocks, 1000);
  updateClocks(); // Run immediately on page load
setInterval(updateClock, 1000);
</script>
```

::: {#clock style="font-size: 24px; font-weight: bold;"}
:::

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
```

##  {.tabset}

### Corrente {.tabset}

```{r, echo=FALSE, results='asis'}
for (i in seq_along(tabelle_formattate[[1]])) {
  temp_file <- tempfile(fileext = ".Rmd")
  tab_label <- names(tabelle_formattate[[1]])[i] #paste0("Tab ", i)
  
  cat(sprintf("#### %s\n\n", tab_label))
  
  cat(
    knitr::knit_child(text = c(
      "```{r, echo=FALSE, results='asis'}",
      sprintf("ft <- tabelle_formattate[[1]][[%d]]", i),
      "ft",
      "```"
    ), quiet = TRUE),
    sep = "\n"
  )
}
```

### Prossima {.tabset}

```{r, echo=FALSE, results='asis'}
for (i in seq_along(tabelle_formattate[[2]])) {
  temp_file <- tempfile(fileext = ".Rmd")
  tab_label <- names(tabelle_formattate[[2]])[i] #paste0("Tab ", i)
  
  cat(sprintf("#### %s\n\n", tab_label))
  
  cat(
    knitr::knit_child(text = c(
      "```{r, echo=FALSE, results='asis'}",
      sprintf("ft <- tabelle_formattate[[2]][[%d]]", i),
      "ft",
      "```"
    ), quiet = TRUE),
    sep = "\n"
  )
}
```

### Ore Nadia

<div style="text-align: center; margin-bottom: 1em;">
  <button onclick="changeMonth(-1)">← Precedente</button>
  <button onclick="changeMonth(1)">Successivo →</button>
</div>

<div id="calendar-container"></div>

<script>
let displayDate = new Date();  // Global variable to track displayed month

function generateCalendar() {
  const year = displayDate.getFullYear();
  const month = displayDate.getMonth(); // 0 = Jan

  const firstDay = new Date(year, month, 1).getDay();
  const numDays = new Date(year, month + 1, 0).getDate();
  const keyPrefix = `${year}-${String(month + 1).padStart(2, '0')}`;

  let calendarHTML = `<table border="1" style="border-collapse:collapse; width:100%">`;
  calendarHTML += `<tr><th colspan="7">${displayDate.toLocaleString('default', { month: 'long' })} ${year}</th></tr>`;
  calendarHTML += `<tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>`;

  let day = 1;
  for (let i = 0; i < 6 && day <= numDays; i++) {
    calendarHTML += "<tr>";
    for (let j = 0; j < 7; j++) {
      if ((i === 0 && j < firstDay) || day > numDays) {
        calendarHTML += `<td></td>`;
      } else {
        const inputId = `${keyPrefix}-${String(day).padStart(2, '0')}`;
        const savedValue = localStorage.getItem(inputId) || "";
        calendarHTML += `
          <td>
            <strong>${day}</strong><br>
            <input type="text" id="${inputId}" value="${savedValue}" style="width: 90%"/>
          </td>`;
        day++;
      }
    }
    calendarHTML += "</tr>";
  }
  calendarHTML += "</table>";

  document.getElementById("calendar-container").innerHTML = calendarHTML;

  // Save values on change
  const inputs = document.querySelectorAll("#calendar-container input");
  inputs.forEach(input => {
    input.addEventListener("input", (e) => {
      localStorage.setItem(e.target.id, e.target.value);
    });
  });
}

// Called when Prev/Next buttons are clicked
function changeMonth(offset) {
  displayDate.setMonth(displayDate.getMonth() + offset);
  generateCalendar();
}

document.addEventListener("DOMContentLoaded", generateCalendar);
</script>

<style>
#calendar-container table {
  font-family: sans-serif;
  margin: auto;
}
#calendar-container th {
  background-color: #f0f0f0;
  text-align: center;
}
#calendar-container td {
  text-align: center;
  vertical-align: top;
  padding: 5px;
  height: 100px;
}
#calendar-container input {
  margin-top: 5px;
}
</style>
